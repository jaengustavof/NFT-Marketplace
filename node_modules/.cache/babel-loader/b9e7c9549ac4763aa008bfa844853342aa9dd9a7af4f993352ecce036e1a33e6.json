{"ast":null,"code":"import _regeneratorRuntime from \"/home/gustavo/blockchain/Marketplace/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _objectSpread from \"/home/gustavo/blockchain/Marketplace/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _asyncToGenerator from \"/home/gustavo/blockchain/Marketplace/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _asyncIterator from \"/home/gustavo/blockchain/Marketplace/node_modules/@babel/runtime/helpers/esm/asyncIterator.js\";\nimport debug from 'debug';\nimport { configure } from '../lib/configure.js';\nimport { toUrlSearchParams } from '../lib/to-url-search-params.js';\nimport { textToUrlSafeRpc, rpcArrayToTextArray, rpcToBytes } from '../lib/http-rpc-wire-format.js';\nvar log = debug('ipfs-http-client:pubsub:subscribe');\nexport var createSubscribe = function createSubscribe(options, subsTracker) {\n  return configure(function (api) {\n    function subscribe(_x, _x2) {\n      return _subscribe.apply(this, arguments);\n    }\n    function _subscribe() {\n      _subscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(topic, handler) {\n        var options,\n          done,\n          fail,\n          result,\n          ffWorkaround,\n          _args = arguments;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              options = _args.length > 2 && _args[2] !== undefined ? _args[2] : {};\n              options.signal = subsTracker.subscribe(topic, handler, options.signal);\n              result = new Promise(function (resolve, reject) {\n                done = resolve;\n                fail = reject;\n              });\n              ffWorkaround = setTimeout(function () {\n                return done();\n              }, 1000);\n              api.post('pubsub/sub', {\n                signal: options.signal,\n                searchParams: toUrlSearchParams(_objectSpread({\n                  arg: textToUrlSafeRpc(topic)\n                }, options)),\n                headers: options.headers\n              }).catch(function (err) {\n                subsTracker.unsubscribe(topic, handler);\n                fail(err);\n              }).then(function (response) {\n                clearTimeout(ffWorkaround);\n                if (!response) {\n                  return;\n                }\n                readMessages(response, {\n                  onMessage: handler,\n                  onEnd: function onEnd() {\n                    return subsTracker.unsubscribe(topic, handler);\n                  },\n                  onError: options.onError\n                });\n                done();\n              });\n              return _context.abrupt(\"return\", result);\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return _subscribe.apply(this, arguments);\n    }\n    return subscribe;\n  })(options);\n};\nfunction readMessages(_x3, _x4) {\n  return _readMessages.apply(this, arguments);\n}\nfunction _readMessages() {\n  _readMessages = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(response, _ref) {\n    var onMessage, onEnd, onError, _iteratorAbruptCompletion, _didIteratorError, _iteratorError, _iterator, _step, msg;\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          onMessage = _ref.onMessage, onEnd = _ref.onEnd, onError = _ref.onError;\n          onError = onError || log;\n          _context2.prev = 2;\n          _iteratorAbruptCompletion = false;\n          _didIteratorError = false;\n          _context2.prev = 5;\n          _iterator = _asyncIterator(response.ndjson());\n        case 7:\n          _context2.next = 9;\n          return _iterator.next();\n        case 9:\n          if (!(_iteratorAbruptCompletion = !(_step = _context2.sent).done)) {\n            _context2.next = 24;\n            break;\n          }\n          msg = _step.value;\n          _context2.prev = 11;\n          if (msg.from) {\n            _context2.next = 14;\n            break;\n          }\n          return _context2.abrupt(\"continue\", 21);\n        case 14:\n          onMessage({\n            from: msg.from,\n            data: rpcToBytes(msg.data),\n            seqno: rpcToBytes(msg.seqno),\n            topicIDs: rpcArrayToTextArray(msg.topicIDs)\n          });\n          _context2.next = 21;\n          break;\n        case 17:\n          _context2.prev = 17;\n          _context2.t0 = _context2[\"catch\"](11);\n          _context2.t0.message = \"Failed to parse pubsub message: \".concat(_context2.t0.message);\n          onError(_context2.t0, false, msg);\n        case 21:\n          _iteratorAbruptCompletion = false;\n          _context2.next = 7;\n          break;\n        case 24:\n          _context2.next = 30;\n          break;\n        case 26:\n          _context2.prev = 26;\n          _context2.t1 = _context2[\"catch\"](5);\n          _didIteratorError = true;\n          _iteratorError = _context2.t1;\n        case 30:\n          _context2.prev = 30;\n          _context2.prev = 31;\n          if (!(_iteratorAbruptCompletion && _iterator.return != null)) {\n            _context2.next = 35;\n            break;\n          }\n          _context2.next = 35;\n          return _iterator.return();\n        case 35:\n          _context2.prev = 35;\n          if (!_didIteratorError) {\n            _context2.next = 38;\n            break;\n          }\n          throw _iteratorError;\n        case 38:\n          return _context2.finish(35);\n        case 39:\n          return _context2.finish(30);\n        case 40:\n          _context2.next = 45;\n          break;\n        case 42:\n          _context2.prev = 42;\n          _context2.t2 = _context2[\"catch\"](2);\n          if (!isAbortError(_context2.t2)) {\n            onError(_context2.t2, true);\n          }\n        case 45:\n          _context2.prev = 45;\n          onEnd();\n          return _context2.finish(45);\n        case 48:\n        case \"end\":\n          return _context2.stop();\n      }\n    }, _callee2, null, [[2, 42, 45, 48], [5, 26, 30, 40], [11, 17], [31,, 35, 39]]);\n  }));\n  return _readMessages.apply(this, arguments);\n}\nvar isAbortError = function isAbortError(error) {\n  switch (error.type) {\n    case 'aborted':\n      return true;\n    case 'abort':\n      return true;\n    default:\n      return error.name === 'AbortError';\n  }\n};","map":{"version":3,"names":["debug","configure","toUrlSearchParams","textToUrlSafeRpc","rpcArrayToTextArray","rpcToBytes","log","createSubscribe","options","subsTracker","api","subscribe","_x","_x2","_subscribe","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","topic","handler","done","fail","result","ffWorkaround","_args","wrap","_callee$","_context","prev","next","length","undefined","signal","Promise","resolve","reject","setTimeout","post","searchParams","_objectSpread","arg","headers","catch","err","unsubscribe","then","response","clearTimeout","readMessages","onMessage","onEnd","onError","abrupt","stop","_x3","_x4","_readMessages","_callee2","_ref","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_step","msg","_callee2$","_context2","_asyncIterator","ndjson","sent","value","from","data","seqno","topicIDs","t0","message","concat","t1","return","finish","t2","isAbortError","error","type","name"],"sources":["/home/gustavo/blockchain/Marketplace/node_modules/ipfs-http-client/esm/src/pubsub/subscribe.js"],"sourcesContent":["import debug from 'debug';\nimport { configure } from '../lib/configure.js';\nimport { toUrlSearchParams } from '../lib/to-url-search-params.js';\nimport {\n  textToUrlSafeRpc,\n  rpcArrayToTextArray,\n  rpcToBytes\n} from '../lib/http-rpc-wire-format.js';\nconst log = debug('ipfs-http-client:pubsub:subscribe');\nexport const createSubscribe = (options, subsTracker) => {\n  return configure(api => {\n    async function subscribe(topic, handler, options = {}) {\n      options.signal = subsTracker.subscribe(topic, handler, options.signal);\n      let done;\n      let fail;\n      const result = new Promise((resolve, reject) => {\n        done = resolve;\n        fail = reject;\n      });\n      const ffWorkaround = setTimeout(() => done(), 1000);\n      api.post('pubsub/sub', {\n        signal: options.signal,\n        searchParams: toUrlSearchParams({\n          arg: textToUrlSafeRpc(topic),\n          ...options\n        }),\n        headers: options.headers\n      }).catch(err => {\n        subsTracker.unsubscribe(topic, handler);\n        fail(err);\n      }).then(response => {\n        clearTimeout(ffWorkaround);\n        if (!response) {\n          return;\n        }\n        readMessages(response, {\n          onMessage: handler,\n          onEnd: () => subsTracker.unsubscribe(topic, handler),\n          onError: options.onError\n        });\n        done();\n      });\n      return result;\n    }\n    return subscribe;\n  })(options);\n};\nasync function readMessages(response, {onMessage, onEnd, onError}) {\n  onError = onError || log;\n  try {\n    for await (const msg of response.ndjson()) {\n      try {\n        if (!msg.from) {\n          continue;\n        }\n        onMessage({\n          from: msg.from,\n          data: rpcToBytes(msg.data),\n          seqno: rpcToBytes(msg.seqno),\n          topicIDs: rpcArrayToTextArray(msg.topicIDs)\n        });\n      } catch (err) {\n        err.message = `Failed to parse pubsub message: ${ err.message }`;\n        onError(err, false, msg);\n      }\n    }\n  } catch (err) {\n    if (!isAbortError(err)) {\n      onError(err, true);\n    }\n  } finally {\n    onEnd();\n  }\n}\nconst isAbortError = error => {\n  switch (error.type) {\n  case 'aborted':\n    return true;\n  case 'abort':\n    return true;\n  default:\n    return error.name === 'AbortError';\n  }\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}