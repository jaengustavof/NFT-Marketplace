{"ast":null,"code":"import _regeneratorRuntime from\"/home/gustavo/blockchain/Marketplace/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/gustavo/blockchain/Marketplace/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/gustavo/blockchain/Marketplace/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from'react';import{ethers}from\"ethers\";import{Row,Col,Card,Button}from'react-bootstrap';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Home=function Home(_ref){var marketplace=_ref.marketplace,nft=_ref.nft;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),items=_useState4[0],setItems=_useState4[1];var loadMarketplaceItem=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var itemCount,items,i,item,uri,response,metadata,totalPrice;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return marketplace.itemCount();case 2:itemCount=_context.sent;items=[];console.log(itemCount);i=1;case 6:if(!(i<=itemCount)){_context.next=27;break;}_context.next=9;return marketplace.items(i);case 9:item=_context.sent;if(item.sold){_context.next=24;break;}_context.next=13;return nft.tokenURI(item.tokenId);case 13:uri=_context.sent;_context.next=16;return fetch(uri);case 16:response=_context.sent;_context.next=19;return response.json();case 19:metadata=_context.sent;_context.next=22;return marketplace.getTotalPrice(item.itemId);case 22:totalPrice=_context.sent;items.push({totalPrice:totalPrice,itemId:item.itemId,seller:item.seller,name:metadata.name,description:metadata.description,image:metadata.image});case 24:i++;_context.next=6;break;case 27:setLoading(false);setItems(items);case 29:case\"end\":return _context.stop();}},_callee);}));return function loadMarketplaceItem(){return _ref2.apply(this,arguments);};}();var buyMarketItem=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(item){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return marketplace.purchaseItem(item.itemId,{value:item.totalPrice});case 2:_context2.next=4;return _context2.sent.wait();case 4:loadMarketplaceItem();case 5:case\"end\":return _context2.stop();}},_callee2);}));return function buyMarketItem(_x){return _ref3.apply(this,arguments);};}();useEffect(function(){loadMarketplaceItem();},[]);if(loading)return/*#__PURE__*/_jsx(\"main\",{style:{padding:\"1rem 0\"},children:/*#__PURE__*/_jsx(\"h2\",{children:\"Loading...\"})});return/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center\",children:items.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"px-5 container\",children:/*#__PURE__*/_jsx(Row,{xs:1,md:2,lg:4,className:\"g-4 py-5\",children:items.map(function(item,idx){return/*#__PURE__*/_jsx(Col,{className:\"overflow-hidden\",children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(Card.Img,{variant:\"top\",src:item.image}),/*#__PURE__*/_jsxs(Card.Body,{color:\"secondary\",children:[/*#__PURE__*/_jsx(Card.Title,{children:item.name}),/*#__PURE__*/_jsx(Card.Text,{children:item.description})]}),/*#__PURE__*/_jsx(Card.Footer,{children:/*#__PURE__*/_jsx(\"div\",{className:\"d-grid\",children:/*#__PURE__*/_jsxs(Button,{onClick:function onClick(){return buyMarketItem(item);},variant:\"primary\",size:\"lg\",children:[\"Buy by \",ethers.utils.formatEther(item.totalPrice),\" ETH\"]})})})]})},idx);})})}):/*#__PURE__*/_jsx(\"main\",{style:{padding:\"1rem 0\"},children:/*#__PURE__*/_jsx(\"h2\",{children:\"No assets\"})})});};export default Home;","map":{"version":3,"names":["useState","useEffect","ethers","Row","Col","Card","Button","jsx","_jsx","jsxs","_jsxs","Home","_ref","marketplace","nft","_useState","_useState2","_slicedToArray","loading","setLoading","_useState3","_useState4","items","setItems","loadMarketplaceItem","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","itemCount","i","item","uri","response","metadata","totalPrice","wrap","_callee$","_context","prev","next","sent","console","log","sold","tokenURI","tokenId","fetch","json","getTotalPrice","itemId","push","seller","name","description","image","stop","apply","arguments","buyMarketItem","_ref3","_callee2","_callee2$","_context2","purchaseItem","value","wait","_x","style","padding","children","className","length","xs","md","lg","map","idx","Img","variant","src","Body","color","Title","Text","Footer","onClick","size","utils","formatEther"],"sources":["/home/gustavo/blockchain/Marketplace/src/frontend/components/Home.js"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { ethers } from \"ethers\";\nimport { Row, Col, Card, Button } from 'react-bootstrap';\n\nconst Home = ({ marketplace, nft }) => {\n    const [loading, setLoading] = useState(true);\n    const [items, setItems] = useState([]);\n    const loadMarketplaceItem = async () => {\n        const itemCount = await (marketplace.itemCount());\n        let items = []\n        console.log(itemCount)\n        \n        for (let i = 1; i <= itemCount; i++) {\n            const item = await marketplace.items(i);\n            if (!item.sold) {\n                const uri = await nft.tokenURI(item.tokenId);\n                const response = await fetch(uri);\n                const metadata = await response.json()\n                const totalPrice = await marketplace.getTotalPrice(item.itemId);\n                items.push({\n                    totalPrice,\n                    itemId: item.itemId,\n                    seller: item.seller,\n                    name: metadata.name,\n                    description: metadata.description,\n                    image: metadata.image\n                });\n            }\n        }\n        \n        setLoading(false);\n        setItems(items);\n    }\n\n    const buyMarketItem = async (item) => {\n        await (await marketplace.purchaseItem(item.itemId, { value: item.totalPrice })).wait();\n        loadMarketplaceItem();\n    }\n\n    useEffect(() => {\n        loadMarketplaceItem()\n\n        \n    }, [])\n\n    if (loading) return (\n        <main style={{ padding: \"1rem 0\" }}>\n            <h2>Loading...</h2>\n        </main>\n    )\n\n    return (\n        <div className=\"flex justify-center\">\n            {items.length > 0 ?\n                <div className=\"px-5 container\">\n                    <Row xs={1} md={2} lg={4} className=\"g-4 py-5\">\n                        {items.map((item, idx) => (\n                            <Col key={idx} className=\"overflow-hidden\">\n                                <Card>\n                                    <Card.Img variant=\"top\" src={item.image} />\n                                    <Card.Body color=\"secondary\">\n                                        <Card.Title>{item.name}</Card.Title>\n                                        <Card.Text>{item.description}</Card.Text>\n                                    </Card.Body>\n                                    <Card.Footer>\n                                        <div className=\"d-grid\">\n                                            <Button onClick={() => buyMarketItem(item)} variant=\"primary\" size=\"lg\">\n                                                Buy by {ethers.utils.formatEther(item.totalPrice)} ETH\n                                            </Button>\n                                        </div>\n                                    </Card.Footer>\n                                </Card>\n                            </Col>\n                        ))}\n                    </Row>\n                </div>\n                : (\n                    <main style={{ padding: \"1rem 0\" }}>\n                        <h2>No assets</h2>\n                    </main>\n                )}\n        </div>\n    );\n}\n\nexport default Home"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}